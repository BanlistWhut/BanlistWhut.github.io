(window.webpackJsonp=window.webpackJsonp||[]).push([[295],{672:function(t,s,n){"use strict";n.r(s);var a=n(27),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"概述"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[t._v("#")]),t._v(" 概述")]),t._v(" "),n("p",[t._v("kubeadm 是 kubernetes 的集群安装工具，能够快速安装 kubernetes 集群，安装 kubernetes 主要是安装它的各个镜像，而 kubeadm 已经为我们集成好了运行 kubernetes 所需的基本镜像。但由于国内的网络原因，在搭建环境时，无法拉取到这些镜像。此时我们只需要修改为阿里云提供的镜像服务即可解决该问题。")]),t._v(" "),n("h2",{attrs:{id:"创建并修改配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建并修改配置"}},[t._v("#")]),t._v(" 创建并修改配置")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 导出配置文件")]),t._v("\nkubeadm config print init-defaults --kubeconfig ClusterConfiguration "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" kubeadm.yml\n")])])]),n("div",{staticClass:"language-yml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubeadm.k8s.io/v1beta2\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("bootstrapTokens")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("groups")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" system"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("bootstrappers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("kubeadm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("default"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("token\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("token")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" abcdef.0123456789abcdef\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ttl")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 24h0m0s\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("usages")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" signing\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" authentication\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" InitConfiguration\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("localAPIEndpoint")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 修改为主节点 IP")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("advertiseAddress")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 192.168.141.110\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("bindPort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6443")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nodeRegistration")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("criSocket")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /var/run/dockershim.sock\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("taints")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("effect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" NoSchedule\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("role.kubernetes.io/master\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiServer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("timeoutForControlPlane")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 4m0s\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubeadm.k8s.io/v1beta2\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("certificatesDir")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/kubernetes/pki\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("clusterName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("controllerManager")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dns")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CoreDNS\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("etcd")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("local")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dataDir")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /var/lib/etcd\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 国内不能访问 Google，修改为阿里云")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("imageRepository")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" registry.aliyuncs.com/google_containers\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterConfiguration\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 修改版本号")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kubernetesVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1.15.0\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networking")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dnsDomain")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cluster.local\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置 POD 所在网段为我们虚拟机不重叠的网段（这里用的是 Flannel 默认网段）")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("podSubnet")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10.244.0.0/16"')]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceSubnet")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10.96.0.0/12\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scheduler")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h2",{attrs:{id:"查看所需镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看所需镜像"}},[t._v("#")]),t._v(" 查看所需镜像")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("kubeadm config images list --config kubeadm.yml\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 输出如下")]),t._v("\nregistry.aliyuncs.com/google_containers/kube-apiserver:v1.15.0\nregistry.aliyuncs.com/google_containers/kube-controller-manager:v1.15.0\nregistry.aliyuncs.com/google_containers/kube-scheduler:v1.15.0\nregistry.aliyuncs.com/google_containers/kube-proxy:v1.15.0\nregistry.aliyuncs.com/google_containers/pause:3.1\nregistry.aliyuncs.com/google_containers/etcd:3.3.10\nregistry.aliyuncs.com/google_containers/coredns:1.3.1\n")])])]),n("h2",{attrs:{id:"拉取所需镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#拉取所需镜像"}},[t._v("#")]),t._v(" 拉取所需镜像")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("kubeadm config images pull --config kubeadm.yml\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 输出如下")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("config/images"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Pulled registry.aliyuncs.com/google_containers/kube-apiserver:v1.15.0\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("config/images"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Pulled registry.aliyuncs.com/google_containers/kube-controller-manager:v1.15.0\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("config/images"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Pulled registry.aliyuncs.com/google_containers/kube-scheduler:v1.15.0\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("config/images"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Pulled registry.aliyuncs.com/google_containers/kube-proxy:v1.15.0\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("config/images"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Pulled registry.aliyuncs.com/google_containers/pause:3.1\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("config/images"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Pulled registry.aliyuncs.com/google_containers/etcd:3.3.10\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("config/images"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Pulled registry.aliyuncs.com/google_containers/coredns:1.3.1\n")])])]),n("h2",{attrs:{id:"安装主节点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装主节点"}},[t._v("#")]),t._v(" 安装主节点")]),t._v(" "),n("p",[t._v("执行以下命令初始化主节点，该命令指定了初始化时需要使用的配置文件，其中添加 "),n("code",[t._v("--upload-certs")]),t._v(" 参数可以在后续执行加入节点时自动分发证书文件。追加的 "),n("code",[t._v("tee kubeadm-init.log")]),t._v(" 用以输出日志。")]),t._v(" "),n("blockquote",[n("p",[n("strong",[t._v("注意：")]),t._v(" 如果安装 kubernetes 版本和下载的镜像版本不统一则会出现 "),n("code",[t._v("timed out waiting for the condition")]),t._v(" 错误。中途失败或是想修改配置可以使用 "),n("code",[t._v("kubeadm reset")]),t._v(" 命令重置配置，再做初始化操作即可。")])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("kubeadm init --config"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("kubeadm.yml --upload-certs "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("tee")]),t._v(" kubeadm-init.log\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 输出如下")]),t._v("\nFlag --experimental-upload-certs has been deprecated, use --upload-certs instead\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("init"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Using Kubernetes version: v1.15.0\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("preflight"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Running pre-flight checks\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("WARNING IsDockerSystemdCheck"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": detected "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cgroupfs"')]),t._v(" as the Docker cgroup driver. The recommended driver is "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"systemd"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v(" Please follow the guide at https://kubernetes.io/docs/setup/cri/\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("preflight"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Pulling images required "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" setting up a Kubernetes cluster\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("preflight"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" This might take a minute or two, depending on the speed of your internet connection\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("preflight"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" You can also perform this action "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" beforehand using "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'kubeadm config images pull'")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-start"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Writing kubelet environment "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" with flags to "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/lib/kubelet/kubeadm-flags.env"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-start"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Writing kubelet configuration to "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/lib/kubelet/config.yaml"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-start"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Activating the kubelet "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Using certificateDir folder "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/etc/kubernetes/pki"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Generating "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ca"')]),t._v(" certificate and key\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Generating "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"apiserver-kubelet-client"')]),t._v(" certificate and key\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Generating "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"apiserver"')]),t._v(" certificate and key\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" apiserver serving cert is signed "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" DNS names "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubernetes-master kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" and IPs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.96")]),t._v(".0.1 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".141.110"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Generating "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"front-proxy-ca"')]),t._v(" certificate and key\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Generating "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"front-proxy-client"')]),t._v(" certificate and key\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Generating "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"etcd/ca"')]),t._v(" certificate and key\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Generating "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"etcd/server"')]),t._v(" certificate and key\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" etcd/server serving cert is signed "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" DNS names "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubernetes-master localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" and IPs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".141.110 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1 ::1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Generating "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"apiserver-etcd-client"')]),t._v(" certificate and key\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Generating "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"etcd/peer"')]),t._v(" certificate and key\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" etcd/peer serving cert is signed "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" DNS names "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubernetes-master localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" and IPs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".141.110 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1 ::1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Generating "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"etcd/healthcheck-client"')]),t._v(" certificate and key\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Generating "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sa"')]),t._v(" key and public key\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubeconfig"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Using kubeconfig folder "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/etc/kubernetes"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubeconfig"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Writing "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"admin.conf"')]),t._v(" kubeconfig "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubeconfig"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Writing "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kubelet.conf"')]),t._v(" kubeconfig "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubeconfig"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Writing "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"controller-manager.conf"')]),t._v(" kubeconfig "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubeconfig"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Writing "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"scheduler.conf"')]),t._v(" kubeconfig "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("control-plane"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Using manifest folder "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/etc/kubernetes/manifests"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("control-plane"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Creating static Pod manifest "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kube-apiserver"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("control-plane"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Creating static Pod manifest "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kube-controller-manager"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("control-plane"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Creating static Pod manifest "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kube-scheduler"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("etcd"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Creating static Pod manifest "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("local")]),t._v(" etcd "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/etc/kubernetes/manifests"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("wait-control-plane"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Waiting "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" the kubelet to boot up the control plane as static Pods from directory "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/etc/kubernetes/manifests"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v(" This can take up to 4m0s\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("apiclient"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" All control plane components are healthy after "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("23.006217")]),t._v(" seconds\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("upload-config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Storing the configuration used "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" ConfigMap "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kubeadm-config"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" the "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kube-system"')]),t._v(" Namespace\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Creating a ConfigMap "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kubelet-config-1.15"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" namespace kube-system with the configuration "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" the kubelets "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" the cluster\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("upload-certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Storing the certificates "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" Secret "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kubeadm-certs"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" the "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kube-system"')]),t._v(" Namespace\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("upload-certs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Using certificate key:\n4a351218cf34c15b04b08b7d916c27a625418145d8d3b281ec125fd2b2ac7ab5\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("mark-control-plane"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Marking the node kubernetes-master as control-plane by adding the label "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"node-role.kubernetes.io/master=''\"")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("mark-control-plane"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Marking the node kubernetes-master as control-plane by adding the taints "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("node-role.kubernetes.io/master:NoSchedule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("bootstrap-token"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Using token: abcdef.0123456789abcdef\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("bootstrap-token"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("bootstrap-token"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" configured RBAC rules to allow Node Bootstrap tokens to post CSRs "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" order "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" nodes to get long term certificate credentials\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("bootstrap-token"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("bootstrap-token"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" configured RBAC rules to allow certificate rotation "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" all node client certificates "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" the cluster\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("bootstrap-token"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Creating the "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cluster-info"')]),t._v(" ConfigMap "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" the "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kube-public"')]),t._v(" namespace\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("addons"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Applied essential addon: CoreDNS\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("addons"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Applied essential addon: kube-proxy\nYour Kubernetes control-plane has initialized successfully"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("\nTo start using your cluster, you need to run the following as a regular user:\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p "),n("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$HOME")]),t._v("/.kube\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" -i /etc/kubernetes/admin.conf "),n("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$HOME")]),t._v("/.kube/config\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("chown")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v(" -u"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v(" -g"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$HOME")]),t._v("/.kube/config\nYou should now deploy a pod network to the cluster.\nRun "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kubectl apply -f [podnetwork].yaml"')]),t._v(" with one of the options listed at:\n  https://kubernetes.io/docs/concepts/cluster-administration/addons/\nThen you can "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),t._v(" any number of worker nodes by running the following on each as root:\nkubeadm "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".141.110:6443 --token abcdef.0123456789abcdef "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --discovery-token-ca-cert-hash sha256:f0759e0d352c1a5de4444782b4a676460b2ea7a2876fa0accab572b8629b72c8 \n")])])]),n("h3",{attrs:{id:"配置-kubectl"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置-kubectl"}},[t._v("#")]),t._v(" 配置 kubectl")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p "),n("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$HOME")]),t._v("/.kube\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" -i /etc/kubernetes/admin.conf "),n("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$HOME")]),t._v("/.kube/config\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 非 ROOT 用户执行")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("chown")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v(" -u"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v(" -g"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$HOME")]),t._v("/.kube/config\n")])])]),n("h3",{attrs:{id:"验证是否成功"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#验证是否成功"}},[t._v("#")]),t._v(" 验证是否成功")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("kubectl get node\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 输出如下")]),t._v("\nNAME                STATUS     ROLES    AGE     VERSION\nkubernetes-master   NotReady   master   4m38s   v1.15.0\n")])])]),n("h2",{attrs:{id:"安装从节点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装从节点"}},[t._v("#")]),t._v(" 安装从节点")]),t._v(" "),n("p",[t._v("将 Node 节点加入到集群中很简单，只需要在 Node 服务器上安装 "),n("strong",[t._v("kubeadm")]),t._v("，"),n("strong",[t._v("kubectl")]),t._v("，"),n("strong",[t._v("kubelet")]),t._v(" 三个工具，然后使用 "),n("code",[t._v("kubeadm join")]),t._v(" 命令加入即可")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("kubeadm "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".141.110:6443 --token abcdef.0123456789abcdef "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    --discovery-token-ca-cert-hash sha256:f0759e0d352c1a5de4444782b4a676460b2ea7a2876fa0accab572b8629b72c8\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 输出如下")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("preflight"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Running pre-flight checks\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("WARNING IsDockerSystemdCheck"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": detected "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cgroupfs"')]),t._v(" as the Docker cgroup driver. The recommended driver is "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"systemd"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v(" Please follow the guide at https://kubernetes.io/docs/setup/cri/\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("preflight"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Reading configuration from the cluster"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("preflight"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" FYI: You can "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("look")]),t._v(" at this config "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" with "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'kubectl -n kube-system get cm kubeadm-config -oyaml'")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-start"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Downloading configuration "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" the kubelet from the "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kubelet-config-1.15"')]),t._v(" ConfigMap "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" the kube-system namespace\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-start"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Writing kubelet configuration to "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/lib/kubelet/config.yaml"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-start"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Writing kubelet environment "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" with flags to "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/lib/kubelet/kubeadm-flags.env"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-start"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Activating the kubelet "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubelet-start"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Waiting "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" the kubelet to perform the TLS Bootstrap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nThis node has joined the cluster:\n* Certificate signing request was sent to apiserver and a response was received.\n* The Kubelet was informed of the new secure connection details.\nRun "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'kubectl get nodes'")]),t._v(" on the control-plane to see this node "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),t._v(" the cluster.\n")])])]),n("h3",{attrs:{id:"验证是否成功-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#验证是否成功-2"}},[t._v("#")]),t._v(" 验证是否成功")]),t._v(" "),n("p",[t._v("回到 Master 主节点查看是否安装成功")]),t._v(" "),n("blockquote",[n("p",[n("strong",[t._v("注意：")]),t._v(" 如果 Node 节点加入 Master 时配置有问题可以在 Node 节点上使用 "),n("code",[t._v("kubeadm reset")]),t._v(" 重置配置再使用 "),n("code",[t._v("kubeadm join")]),t._v(" 命令重新加入即可。希望在 master 节点删除 node ，可以使用 "),n("code",[t._v("kubectl delete nodes <NAME>")]),t._v(" 删除。")])]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("kubectl get node\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 输出如下")]),t._v("\nNAME                 STATUS     ROLES    AGE   VERSION\nkubernetes-master    NotReady   master   20m   v1.15.0\nkubernetes-node-01   NotReady   "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("   16s   v1.15.0\nkubernetes-node-02   NotReady   "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("   6s    v1.15.0\n")])])]),n("h3",{attrs:{id:"查看-pod-状态"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看-pod-状态"}},[t._v("#")]),t._v(" 查看 Pod 状态")]),t._v(" "),n("p",[t._v("coredns 尚未运行，此时我们还需要安装网络插件")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("kubectl get pod -n kube-system -o wide\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 输出如下")]),t._v("\nNAME                                        READY   STATUS    RESTARTS   AGE     IP                NODE                 NOMINATED NODE   READINESS GATES\ncoredns-bccdc95cf-9s4bm                     "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("/1     Pending   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          24m     "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("            "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("               "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\ncoredns-bccdc95cf-s8ggd                     "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("/1     Pending   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          24m     "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("            "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("               "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\netcd-kubernetes-master                      "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          24m     "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".141.110   kubernetes-master    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nkube-apiserver-kubernetes-master            "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          24m     "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".141.110   kubernetes-master    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nkube-controller-manager-kubernetes-master   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          23m     "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".141.110   kubernetes-master    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nkube-proxy-8s87d                            "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          4m56s   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".141.120   kubernetes-node-01   "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nkube-proxy-cbnlb                            "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          4m46s   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".141.121   kubernetes-node-02   "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nkube-proxy-vwhxj                            "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          24m     "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".141.110   kubernetes-master    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nkube-scheduler-kubernetes-master            "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          24m     "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".141.110   kubernetes-master    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("           "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),n("h2",{attrs:{id:"附-扩展阅读"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#附-扩展阅读"}},[t._v("#")]),t._v(" 附：扩展阅读")]),t._v(" "),n("h3",{attrs:{id:"kubeadm-init-的执行过程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#kubeadm-init-的执行过程"}},[t._v("#")]),t._v(" kubeadm init 的执行过程")]),t._v(" "),n("ul",[n("li",[n("strong",[t._v("init：")]),t._v(" 指定版本进行初始化操作")]),t._v(" "),n("li",[n("strong",[t._v("preflight：")]),t._v(" 初始化前的检查和下载所需要的 Docker 镜像文件")]),t._v(" "),n("li",[n("strong",[t._v("kubelet-start：")]),t._v(" 生成 kubelet 的配置文件 "),n("code",[t._v("var/lib/kubelet/config.yaml")]),t._v("，没有这个文件 kubelet 无法启动，所以初始化之前的 kubelet 实际上启动不会成功")]),t._v(" "),n("li",[n("strong",[t._v("certificates：")]),t._v(" 生成 Kubernetes 使用的证书，存放在 "),n("code",[t._v("/etc/kubernetes/pki")]),t._v(" 目录中")]),t._v(" "),n("li",[n("strong",[t._v("kubeconfig：")]),t._v(" 生成 KubeConfig 文件，存放在 "),n("code",[t._v("/etc/kubernetes")]),t._v(" 目录中，组件之间通信需要使用对应文件")]),t._v(" "),n("li",[n("strong",[t._v("control-plane：")]),t._v(" 使用 "),n("code",[t._v("/etc/kubernetes/manifest")]),t._v(" 目录下的 YAML 文件，安装 Master 组件")]),t._v(" "),n("li",[n("strong",[t._v("etcd：")]),t._v(" 使用 "),n("code",[t._v("/etc/kubernetes/manifest/etcd.yaml")]),t._v(" 安装 Etcd 服务")]),t._v(" "),n("li",[n("strong",[t._v("wait-control-plane：")]),t._v(" 等待 control-plan 部署的 Master 组件启动")]),t._v(" "),n("li",[n("strong",[t._v("apiclient：")]),t._v(" 检查 Master 组件服务状态。")]),t._v(" "),n("li",[n("strong",[t._v("uploadconfig：")]),t._v(" 更新配置")]),t._v(" "),n("li",[n("strong",[t._v("kubelet：")]),t._v(" 使用 configMap 配置 kubelet")]),t._v(" "),n("li",[n("strong",[t._v("patchnode：")]),t._v(" 更新 CNI 信息到 Node 上，通过注释的方式记录")]),t._v(" "),n("li",[n("strong",[t._v("mark-control-plane：")]),t._v(" 为当前节点打标签，打了角色 Master，和不可调度标签，这样默认就不会使用 Master 节点来运行 Pod")]),t._v(" "),n("li",[n("strong",[t._v("bootstrap-token：")]),t._v(" 生成 token 记录下来，后边使用 "),n("code",[t._v("kubeadm join")]),t._v(" 往集群中添加节点时会用到")]),t._v(" "),n("li",[n("strong",[t._v("addons：")]),t._v(" 安装附加组件 CoreDNS 和 kube-proxy")])])])}),[],!1,null,null,null);s.default=e.exports}}]);