(window.webpackJsonp=window.webpackJsonp||[]).push([[299],{675:function(t,a,s){"use strict";s.r(a);var n=s(27),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[t._v("#")]),t._v(" 概述")]),t._v(" "),s("p",[t._v("我们知道通过 "),s("code",[t._v("run")]),t._v(" 命令启动容器非常麻烦，Docker 提供了 Compose 为我们解决了这个问题。那 Kubernetes 是如何解决这个问题的呢？其实很简单，使用 "),s("code",[t._v("kubectl create")]),t._v(" 命令就可以做到和 Compose 一样的效果了，该命令可以通过配置文件快速创建一个集群资源对象。")]),t._v(" "),s("h2",{attrs:{id:"创建-yaml-配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建-yaml-配置文件"}},[t._v("#")]),t._v(" 创建 YAML 配置文件")]),t._v(" "),s("h3",{attrs:{id:"部署-deployment"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#部署-deployment"}},[t._v("#")]),t._v(" 部署 Deployment")]),t._v(" "),s("p",[t._v("创建一个名为 "),s("code",[t._v("nginx-deployment.yml")]),t._v(" 的配置文件")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# API 版本号")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 类型，如：Pod/ReplicationController/Deployment/Service/Ingress")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deployment\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 元数据")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Kind 的名称")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("app\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 部署的实例数量")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 容器标签的名字，发布 Service 时，selector 需要和这里对应")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置容器，数组类型，说明可以配置多个容器")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 容器名称")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 容器镜像")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.17")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 只有镜像不存在时，才会进行镜像拉取")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("imagePullPolicy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" IfNotPresent\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 暴露端口")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Pod 端口")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 部署")]),t._v("\nkubectl create -f nginx-deployment.yml\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 删除")]),t._v("\nkubectl delete -f nginx-deployment.yml\n")])])]),s("h3",{attrs:{id:"发布-service"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#发布-service"}},[t._v("#")]),t._v(" 发布 Service")]),t._v(" "),s("p",[t._v("创建一个名为 "),s("code",[t._v("nginx-service.yml")]),t._v(" 的配置文件")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# API 版本号")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 类型，如：Pod/ReplicationController/Deployment/Service/Ingress")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Service\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 元数据")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Kind 的名称")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("http\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 暴露端口")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## Service 暴露的端口")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## Pod 上的端口，这里是将 Service 暴露的端口转发到 Pod 端口上")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targetPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 类型")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" LoadBalancer\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 标签选择器")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 需要和上面部署的 Deployment 标签名对应")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 部署")]),t._v("\nkubectl create -f nginx-service.yml\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 删除")]),t._v("\nkubectl delete -f nginx-service.yml\n")])])]),s("h3",{attrs:{id:"镜像拉取策略"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#镜像拉取策略"}},[t._v("#")]),t._v(" 镜像拉取策略")]),t._v(" "),s("p",[t._v("支持三种 ImagePullPolicy")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("Always：")]),t._v(" 不管镜像是否存在都会进行一次拉取")]),t._v(" "),s("li",[s("strong",[t._v("Never：")]),t._v(" 不管镜像是否存在都不会进行拉取")]),t._v(" "),s("li",[s("strong",[t._v("IfNotPresent：")]),t._v(" 只有镜像不存在时，才会进行镜像拉取")])]),t._v(" "),s("p",[t._v("注意")]),t._v(" "),s("ul",[s("li",[t._v("默认为 "),s("code",[t._v("IfNotPresent")]),t._v("，但 "),s("code",[t._v(":latest")]),t._v(" 标签的镜像默认为 "),s("code",[t._v("Always")])]),t._v(" "),s("li",[t._v("拉取镜像时 Docker 会进行校验，如果镜像中的 MD5 码没有变，则不会拉取镜像数据")]),t._v(" "),s("li",[t._v("生产环境中应该尽量避免使用 "),s("code",[t._v(":latest")]),t._v(" 标签，而开发环境中可以借助 "),s("code",[t._v(":latest")]),t._v(" 标签自动拉取最新的镜像")])]),t._v(" "),s("h2",{attrs:{id:"验证是否生效"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#验证是否生效"}},[t._v("#")]),t._v(" 验证是否生效")]),t._v(" "),s("h3",{attrs:{id:"查看-pod-列表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看-pod-列表"}},[t._v("#")]),t._v(" 查看 Pod 列表")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("kubectl get pods\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 输出如下")]),t._v("\nNAME                         READY   STATUS    RESTARTS   AGE\nnginx-app-64bb598779-2pplx   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          25m\nnginx-app-64bb598779-824lc   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1     Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          25m\n")])])]),s("h3",{attrs:{id:"查看-deployment-列表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看-deployment-列表"}},[t._v("#")]),t._v(" 查看 Deployment 列表")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("kubectl get deployment\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 输出如下")]),t._v("\nNAME        READY   UP-TO-DATE   AVAILABLE   AGE\nnginx-app   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("/2     "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("            "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("           25m\n")])])]),s("h3",{attrs:{id:"查看-service-列表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看-service-列表"}},[t._v("#")]),t._v(" 查看 Service 列表")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("kubectl get "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 输出如下")]),t._v("\nNAME         TYPE           CLUSTER-IP     EXTERNAL-IP   PORT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("S"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("        AGE\nkubernetes   ClusterIP      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.96")]),t._v(".0.1      "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("/TCP        20h\nnginx-http    LoadBalancer   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.98")]),t._v(".49.142   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("pending"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("     "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(":31631/TCP   14m\n")])])]),s("h3",{attrs:{id:"查看-service-详情"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看-service-详情"}},[t._v("#")]),t._v(" 查看 Service 详情")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("kubectl describe "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" nginx-app\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 输出如下")]),t._v("\nName:                     nginx-http\nNamespace:                default\nLabels:                   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nAnnotations:              "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nSelector:                 "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx\nType:                     LoadBalancer\nIP:                       "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.98")]),t._v(".49.142\nPort:                     "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("unset"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("/TCP\nTargetPort:               "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("/TCP\nNodePort:                 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("unset"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("31631")]),t._v("/TCP\nEndpoints:                "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.244")]),t._v(".141.205:80,10.244.2.4:80\nSession Affinity:         None\nExternal Traffic Policy:  Cluster\nEvents:                   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),s("h3",{attrs:{id:"通过浏览器访问"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#通过浏览器访问"}},[t._v("#")]),t._v(" 通过浏览器访问")]),t._v(" "),s("p",[t._v("通过浏览器访问 "),s("a",{attrs:{href:"http://www.qfdmy.com/wp-content/themes/quanbaike/go.php?url=aHR0cDovLzE5Mi4xNjguMTQxLjEyMDozMTYzMS8=",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://192.168.141.120:31631/"),s("OutboundLink")],1),t._v(" ，出现 Nginx 欢迎页即表示成功")]),t._v(" "),s("h2",{attrs:{id:"集成环境部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#集成环境部署"}},[t._v("#")]),t._v(" 集成环境部署")]),t._v(" "),s("p",[t._v("也可以不区分配置文件，一次性部署 Deployment 和 Service，创建一个名为 "),s("code",[t._v("nginx.yml")]),t._v(" 的配置文件，配置内容如下：")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deployment\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("app\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Service\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("http\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targetPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 可以指定 NodePort 端口，默认范围是：30000-32767")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# nodePort: 30080")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" LoadBalancer\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 部署")]),t._v("\nkubectl create -f nginx.yml\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 删除")]),t._v("\nkubectl delete -f nginx.yml\n")])])]),s("h2",{attrs:{id:"附-扩展阅读"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#附-扩展阅读"}},[t._v("#")]),t._v(" 附：扩展阅读")]),t._v(" "),s("h3",{attrs:{id:"修改默认的端口范围"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改默认的端口范围"}},[t._v("#")]),t._v(" 修改默认的端口范围")]),t._v(" "),s("p",[t._v("Kubernetes 服务的 NodePort 默认端口范围是 30000-32767，在某些场合下，这个限制不太适用，我们可以自定义它的端口范围，操作步骤如下：")]),t._v(" "),s("p",[t._v("编辑 "),s("code",[t._v("vi /etc/kubernetes/manifests/kube-apiserver.yaml")]),t._v("配置文件，增加配置 "),s("code",[t._v("--service-node-port-range=2-65535")])]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("creationTimestamp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token null important"}},[t._v("null")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("component")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("apiserver\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tier")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" control"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("plane\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("apiserver\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("system\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" kube"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("apiserver\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 在这里增加配置即可")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("service"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("port"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("range=2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("65535")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("advertise"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("address=192.168.141.150\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("allow"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("privileged=true\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("authorization"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("mode=Node"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("RBAC\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ca"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("file=/etc/kubernetes/pki/ca.crt\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("enable"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("admission"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("plugins=NodeRestriction\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("enable"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("bootstrap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("token"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("auth=true\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("etcd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cafile=/etc/kubernetes/pki/etcd/ca.crt\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("etcd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("certfile=/etc/kubernetes/pki/apiserver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("etcd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("client.crt\n// 以下配置省略"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("\n")])])]),s("p",[t._v("使用 "),s("code",[t._v("docker ps")]),t._v(" 命令找到 "),s("code",[t._v("kube-apiserver")]),t._v(" 容器，再使用 "),s("code",[t._v("docker restart <ApiServer 容器 ID>")]),t._v(" 即可生效。")])])}),[],!1,null,null,null);a.default=e.exports}}]);